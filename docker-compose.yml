services:
  pathgreen-engine:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    volumes:
      - ./backend:/app
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - SUPABASE_URL=${SUPABASE_URL}
      - SUPABASE_KEY=${SUPABASE_KEY}
      - PATHGREEN_API_KEY=${PATHGREEN_API_KEY}
      - PRODUCTION=${PRODUCTION:-false}
      - PATH=/opt/venv/bin:$PATH
    command: /opt/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8080 --reload
    restart: always

  next-frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: builder
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_WS_URL=ws://localhost:8080/ws
      - NODE_ENV=development
      - HOSTNAME=0.0.0.0
    volumes:
      - ./frontend:/app
      - /app/node_modules
      - /app/.next
    command: pnpm dev
    depends_on:
      - pathgreen-engine
    restart: always
