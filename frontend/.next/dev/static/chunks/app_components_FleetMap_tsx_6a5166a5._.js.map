{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/components/FleetMap.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\nimport dynamic from \"next/dynamic\";\nimport type { EmissionData } from \"../hooks/useWebSocket\";\n\n// Dynamically import Leaflet components (they require window)\nconst MapContainer = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.MapContainer),\n  { ssr: false }\n);\nconst TileLayer = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.TileLayer),\n  { ssr: false }\n);\nconst Marker = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.Marker),\n  { ssr: false }\n);\nconst Popup = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.Popup),\n  { ssr: false }\n);\nconst Polyline = dynamic(\n  () => import(\"react-leaflet\").then((mod) => mod.Polyline),\n  { ssr: false }\n);\n\ntype FleetMapProps = {\n  vehicles: EmissionData[];\n  onVehicleSelect?: (vehicleId: string) => void;\n  selectedVehicle?: string | null;\n};\n\n// India center (approximately Delhi-Mumbai midpoint)\nconst INDIA_CENTER: [number, number] = [24.5, 78.0];\nconst DEFAULT_ZOOM = 6;\n\n// Emission thresholds for color coding\nconst EMISSION_THRESHOLD_LOW = 680;  // g/km\nconst EMISSION_THRESHOLD_HIGH = 720; // g/km\n\nfunction getVehicleColor(vehicle: EmissionData): string {\n  if (vehicle.alert_severity === \"CRITICAL\") return \"#FF3333\";\n  if (vehicle.alert_severity === \"WARNING\") return \"#FFB800\";\n  if (vehicle.co2_rate_g_per_km > EMISSION_THRESHOLD_HIGH) return \"#FF3333\";\n  if (vehicle.co2_rate_g_per_km > EMISSION_THRESHOLD_LOW) return \"#FFB800\";\n  return \"#00FF66\";\n}\n\nfunction createVehicleIcon(color: string, isSelected: boolean) {\n  if (typeof window === \"undefined\") return null;\n  \n  const L = require(\"leaflet\");\n  \n  const size = isSelected ? 16 : 12;\n  const borderWidth = isSelected ? 3 : 2;\n  \n  return L.divIcon({\n    className: \"vehicle-marker\",\n    html: `\n      <div style=\"\n        width: ${size}px;\n        height: ${size}px;\n        background: ${color};\n        border: ${borderWidth}px solid #0A0A0A;\n        border-radius: 50%;\n        box-shadow: 0 0 ${isSelected ? 15 : 8}px ${color}80;\n        transform: translate(-50%, -50%);\n      \"></div>\n    `,\n    iconSize: [size, size],\n    iconAnchor: [size / 2, size / 2],\n  });\n}\n\nexport function FleetMap({ vehicles, onVehicleSelect, selectedVehicle }: FleetMapProps) {\n  const [isClient, setIsClient] = useState(false);\n  const [L, setL] = useState<typeof import(\"leaflet\") | null>(null);\n  \n  useEffect(() => {\n    setIsClient(true);\n    // Import Leaflet CSS\n    import(\"leaflet/dist/leaflet.css\");\n    // Import Leaflet\n    import(\"leaflet\").then((leaflet) => {\n      setL(leaflet.default);\n    });\n  }, []);\n  \n  if (!isClient || !L) {\n    return (\n      <div className=\"w-full h-full flex items-center justify-center\" style={{ background: \"var(--bg-void)\" }}>\n        <div className=\"mono\" style={{ color: \"var(--text-muted)\" }}>\n          Loading map...\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <MapContainer\n      center={INDIA_CENTER}\n      zoom={DEFAULT_ZOOM}\n      style={{ width: \"100%\", height: \"100%\", background: \"var(--bg-void)\" }}\n      zoomControl={true}\n    >\n      {/* Dark map tiles - CartoDB Dark Matter */}\n      <TileLayer\n        attribution='&copy; <a href=\"https://carto.com/\">CARTO</a>'\n        url=\"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\n      />\n      \n      {/* Vehicle markers */}\n      {vehicles.map((vehicle) => {\n        const color = getVehicleColor(vehicle);\n        const isSelected = vehicle.vehicle_id === selectedVehicle;\n        const icon = createVehicleIcon(color, isSelected);\n        \n        if (!icon) return null;\n        \n        return (\n          <Marker\n            key={vehicle.vehicle_id}\n            position={[vehicle.latitude, vehicle.longitude]}\n            icon={icon}\n            eventHandlers={{\n              click: () => onVehicleSelect?.(vehicle.vehicle_id),\n            }}\n          >\n            <Popup>\n              <div style={{ \n                fontFamily: \"var(--font-mono)\", \n                fontSize: \"12px\",\n                minWidth: \"200px\",\n              }}>\n                <div style={{ \n                  fontWeight: 700, \n                  fontSize: \"14px\",\n                  marginBottom: \"8px\",\n                  color: color,\n                }}>\n                  {vehicle.vehicle_id}\n                </div>\n                \n                <div style={{ display: \"grid\", gap: \"4px\", color: \"var(--text-primary)\" }}>\n                  <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n                    <span style={{ color: \"var(--text-muted)\" }}>Speed</span>\n                    <span>{vehicle.speed_kmh.toFixed(1)} km/h</span>\n                  </div>\n                  <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n                    <span style={{ color: \"var(--text-muted)\" }}>CO₂ Rate</span>\n                    <span style={{ color }}>{vehicle.co2_rate_g_per_km.toFixed(1)} g/km</span>\n                  </div>\n                  <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n                    <span style={{ color: \"var(--text-muted)\" }}>Total CO₂</span>\n                    <span>{vehicle.cumulative_co2_kg.toFixed(2)} kg</span>\n                  </div>\n                  <div style={{ display: \"flex\", justifyContent: \"space-between\" }}>\n                    <span style={{ color: \"var(--text-muted)\" }}>Efficiency</span>\n                    <span>{vehicle.fuel_efficiency_km_l.toFixed(1)} km/L</span>\n                  </div>\n                </div>\n                \n                {vehicle.alert_type && (\n                  <div style={{\n                    marginTop: \"8px\",\n                    padding: \"4px 8px\",\n                    background: vehicle.alert_severity === \"CRITICAL\" ? \"var(--accent-red)\" : \"var(--accent-amber)\",\n                    color: \"var(--bg-primary)\",\n                    fontSize: \"10px\",\n                    fontWeight: 600,\n                    textTransform: \"uppercase\",\n                  }}>\n                    {vehicle.alert_type}\n                  </div>\n                )}\n              </div>\n            </Popup>\n          </Marker>\n        );\n      })}\n    </MapContainer>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;;;;;AAHA;;;AAMA,8DAA8D;AAC9D,MAAM,eAAe,IAAA,8UAAO,EAC1B,IAAM,0OAAwB,IAAI,CAAC,CAAC,MAAQ,IAAI,YAAY;;;;;;IAC1D,KAAK;;KAFH;AAIN,MAAM,YAAY,IAAA,8UAAO,EACvB,IAAM,0OAAwB,IAAI,CAAC,CAAC,MAAQ,IAAI,SAAS;;;;;;IACvD,KAAK;;MAFH;AAIN,MAAM,SAAS,IAAA,8UAAO,EACpB,IAAM,0OAAwB,IAAI,CAAC,CAAC,MAAQ,IAAI,MAAM;;;;;;IACpD,KAAK;;MAFH;AAIN,MAAM,QAAQ,IAAA,8UAAO,EACnB,IAAM,0OAAwB,IAAI,CAAC,CAAC,MAAQ,IAAI,KAAK;;;;;;IACnD,KAAK;;MAFH;AAIN,MAAM,WAAW,IAAA,8UAAO,QACtB,IAAM,0OAAwB,IAAI,CAAC,CAAC,MAAQ,IAAI,QAAQ;;;;;;IACtD,KAAK;;;AAST,qDAAqD;AACrD,MAAM,eAAiC;IAAC;IAAM;CAAK;AACnD,MAAM,eAAe;AAErB,uCAAuC;AACvC,MAAM,yBAAyB,KAAM,OAAO;AAC5C,MAAM,0BAA0B,KAAK,OAAO;AAE5C,SAAS,gBAAgB,OAAqB;IAC5C,IAAI,QAAQ,cAAc,KAAK,YAAY,OAAO;IAClD,IAAI,QAAQ,cAAc,KAAK,WAAW,OAAO;IACjD,IAAI,QAAQ,iBAAiB,GAAG,yBAAyB,OAAO;IAChE,IAAI,QAAQ,iBAAiB,GAAG,wBAAwB,OAAO;IAC/D,OAAO;AACT;AAEA,SAAS,kBAAkB,KAAa,EAAE,UAAmB;IAC3D;;IAEA,MAAM;IAEN,MAAM,OAAO,aAAa,KAAK;IAC/B,MAAM,cAAc,aAAa,IAAI;IAErC,OAAO,EAAE,OAAO,CAAC;QACf,WAAW;QACX,MAAM,CAAC;;eAEI,EAAE,KAAK;gBACN,EAAE,KAAK;oBACH,EAAE,MAAM;gBACZ,EAAE,YAAY;;wBAEN,EAAE,aAAa,KAAK,EAAE,GAAG,EAAE,MAAM;;;IAGrD,CAAC;QACD,UAAU;YAAC;YAAM;SAAK;QACtB,YAAY;YAAC,OAAO;YAAG,OAAO;SAAE;IAClC;AACF;AAEO,SAAS,SAAS,EAAE,QAAQ,EAAE,eAAe,EAAE,eAAe,EAAiB;;IACpF,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,0UAAQ,EAAC;IACzC,MAAM,CAAC,GAAG,KAAK,GAAG,IAAA,0UAAQ,EAAkC;IAE5D,IAAA,2UAAS;8BAAC;YACR,YAAY;YACZ,qBAAqB;;YAErB,iBAAiB;YACjB,uJAAkB,IAAI;sCAAC,CAAC;oBACtB,KAAK,QAAQ,OAAO;gBACtB;;QACF;6BAAG,EAAE;IAEL,IAAI,CAAC,YAAY,CAAC,GAAG;QACnB,qBACE,8VAAC;YAAI,WAAU;YAAiD,OAAO;gBAAE,YAAY;YAAiB;sBACpG,cAAA,8VAAC;gBAAI,WAAU;gBAAO,OAAO;oBAAE,OAAO;gBAAoB;0BAAG;;;;;;;;;;;IAKnE;IAEA,qBACE,8VAAC;QACC,QAAQ;QACR,MAAM;QACN,OAAO;YAAE,OAAO;YAAQ,QAAQ;YAAQ,YAAY;QAAiB;QACrE,aAAa;;0BAGb,8VAAC;gBACC,aAAY;gBACZ,KAAI;;;;;;YAIL,SAAS,GAAG,CAAC,CAAC;gBACb,MAAM,QAAQ,gBAAgB;gBAC9B,MAAM,aAAa,QAAQ,UAAU,KAAK;gBAC1C,MAAM,OAAO,kBAAkB,OAAO;gBAEtC,IAAI,CAAC,MAAM,OAAO;gBAElB,qBACE,8VAAC;oBAEC,UAAU;wBAAC,QAAQ,QAAQ;wBAAE,QAAQ,SAAS;qBAAC;oBAC/C,MAAM;oBACN,eAAe;wBACb,OAAO,IAAM,kBAAkB,QAAQ,UAAU;oBACnD;8BAEA,cAAA,8VAAC;kCACC,cAAA,8VAAC;4BAAI,OAAO;gCACV,YAAY;gCACZ,UAAU;gCACV,UAAU;4BACZ;;8CACE,8VAAC;oCAAI,OAAO;wCACV,YAAY;wCACZ,UAAU;wCACV,cAAc;wCACd,OAAO;oCACT;8CACG,QAAQ,UAAU;;;;;;8CAGrB,8VAAC;oCAAI,OAAO;wCAAE,SAAS;wCAAQ,KAAK;wCAAO,OAAO;oCAAsB;;sDACtE,8VAAC;4CAAI,OAAO;gDAAE,SAAS;gDAAQ,gBAAgB;4CAAgB;;8DAC7D,8VAAC;oDAAK,OAAO;wDAAE,OAAO;oDAAoB;8DAAG;;;;;;8DAC7C,8VAAC;;wDAAM,QAAQ,SAAS,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAEtC,8VAAC;4CAAI,OAAO;gDAAE,SAAS;gDAAQ,gBAAgB;4CAAgB;;8DAC7D,8VAAC;oDAAK,OAAO;wDAAE,OAAO;oDAAoB;8DAAG;;;;;;8DAC7C,8VAAC;oDAAK,OAAO;wDAAE;oDAAM;;wDAAI,QAAQ,iBAAiB,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAEhE,8VAAC;4CAAI,OAAO;gDAAE,SAAS;gDAAQ,gBAAgB;4CAAgB;;8DAC7D,8VAAC;oDAAK,OAAO;wDAAE,OAAO;oDAAoB;8DAAG;;;;;;8DAC7C,8VAAC;;wDAAM,QAAQ,iBAAiB,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAE9C,8VAAC;4CAAI,OAAO;gDAAE,SAAS;gDAAQ,gBAAgB;4CAAgB;;8DAC7D,8VAAC;oDAAK,OAAO;wDAAE,OAAO;oDAAoB;8DAAG;;;;;;8DAC7C,8VAAC;;wDAAM,QAAQ,oBAAoB,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;;;;;;;;gCAIlD,QAAQ,UAAU,kBACjB,8VAAC;oCAAI,OAAO;wCACV,WAAW;wCACX,SAAS;wCACT,YAAY,QAAQ,cAAc,KAAK,aAAa,sBAAsB;wCAC1E,OAAO;wCACP,UAAU;wCACV,YAAY;wCACZ,eAAe;oCACjB;8CACG,QAAQ,UAAU;;;;;;;;;;;;;;;;;mBAnDtB,QAAQ,UAAU;;;;;YA0D7B;;;;;;;AAGN;GA5GgB;MAAA"}}]
}