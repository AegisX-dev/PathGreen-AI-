{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/hooks/useWebSocket.ts"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState, useCallback, useRef } from \"react\";\n\nexport type EmissionData = {\n  vehicle_id: string;\n  timestamp: number;\n  latitude: number;\n  longitude: number;\n  speed_kmh: number;\n  co2_grams: number;\n  co2_rate_g_per_km: number;\n  cumulative_co2_kg: number;\n  fuel_efficiency_km_l: number;\n  alert_type: string | null;\n  alert_severity: string;\n  alert_message: string | null;\n};\n\nexport type AlertData = {\n  alert_id: string;\n  vehicle_id: string;\n  timestamp: number;\n  alert_type: string;\n  severity: string;\n  message: string;\n  latitude: number;\n  longitude: number;\n};\n\nexport type ChatResponse = {\n  type: \"chat_response\";\n  message_id: string;\n  query: string;\n  response: string;\n  citations: string[];\n  model?: string;\n  timestamp: number;\n};\n\ntype WebSocketMessage =\n  | { type: \"initial_state\"; vehicles: EmissionData[]; alerts: AlertData[] }\n  | { type: \"emission_update\"; data: EmissionData }\n  | { type: \"alert\"; data: AlertData }\n  | { type: \"pong\" }\n  | ChatResponse;\n\ntype ConnectionStatus = \"connecting\" | \"connected\" | \"disconnected\" | \"error\";\n\nconst WS_URL = process.env.NEXT_PUBLIC_WS_URL || \"ws://localhost:8080\";\nconst RECONNECT_DELAY = 3000;\nconst MAX_RECONNECT_ATTEMPTS = 10;\n\nexport function useWebSocket() {\n  const [status, setStatus] = useState<ConnectionStatus>(\"disconnected\");\n  const [vehicles, setVehicles] = useState<Map<string, EmissionData>>(new Map());\n  const [alerts, setAlerts] = useState<AlertData[]>([]);\n  const [lastChatResponse, setLastChatResponse] = useState<ChatResponse | null>(null);\n  \n  const wsRef = useRef<WebSocket | null>(null);\n  const reconnectAttempts = useRef(0);\n  const reconnectTimeout = useRef<NodeJS.Timeout | null>(null);\n  \n  const connect = useCallback(() => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      return;\n    }\n    \n    setStatus(\"connecting\");\n    \n    try {\n      const ws = new WebSocket(WS_URL);\n      wsRef.current = ws;\n      \n      ws.onopen = () => {\n        console.log(\"[WS] Connected to PathGreen-AI\");\n        setStatus(\"connected\");\n        reconnectAttempts.current = 0;\n      };\n      \n      ws.onmessage = (event) => {\n        try {\n          const message: WebSocketMessage = JSON.parse(event.data);\n          \n          switch (message.type) {\n            case \"initial_state\":\n              // Initialize vehicle map from array\n              const vehicleMap = new Map<string, EmissionData>();\n              message.vehicles.forEach((v) => vehicleMap.set(v.vehicle_id, v));\n              setVehicles(vehicleMap);\n              setAlerts(message.alerts);\n              break;\n              \n            case \"emission_update\":\n              setVehicles((prev) => {\n                const next = new Map(prev);\n                next.set(message.data.vehicle_id, message.data);\n                return next;\n              });\n              break;\n              \n            case \"alert\":\n              setAlerts((prev) => [message.data, ...prev].slice(0, 50));\n              break;\n              \n            case \"chat_response\":\n              setLastChatResponse(message);\n              break;\n              \n            case \"pong\":\n              // Heartbeat response, ignore\n              break;\n          }\n        } catch (err) {\n          console.error(\"[WS] Parse error:\", err);\n        }\n      };\n      \n      ws.onerror = (error) => {\n        console.error(\"[WS] Error:\", error);\n        setStatus(\"error\");\n      };\n      \n      ws.onclose = () => {\n        console.log(\"[WS] Disconnected\");\n        setStatus(\"disconnected\");\n        wsRef.current = null;\n        \n        // Attempt reconnection\n        if (reconnectAttempts.current < MAX_RECONNECT_ATTEMPTS) {\n          reconnectAttempts.current++;\n          const delay = RECONNECT_DELAY * Math.pow(1.5, reconnectAttempts.current - 1);\n          console.log(`[WS] Reconnecting in ${delay}ms (attempt ${reconnectAttempts.current})`);\n          \n          reconnectTimeout.current = setTimeout(() => {\n            connect();\n          }, delay);\n        }\n      };\n    } catch (err) {\n      console.error(\"[WS] Connection failed:\", err);\n      setStatus(\"error\");\n    }\n  }, []);\n  \n  const disconnect = useCallback(() => {\n    if (reconnectTimeout.current) {\n      clearTimeout(reconnectTimeout.current);\n    }\n    if (wsRef.current) {\n      wsRef.current.close();\n      wsRef.current = null;\n    }\n    setStatus(\"disconnected\");\n  }, []);\n  \n  const sendChatMessage = useCallback((query: string) => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({ type: \"chat\", query }));\n      setLastChatResponse(null); // Clear previous response\n    }\n  }, []);\n  \n  const sendPing = useCallback(() => {\n    if (wsRef.current?.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({ type: \"ping\" }));\n    }\n  }, []);\n  \n  // Connect on mount\n  useEffect(() => {\n    connect();\n    \n    // Heartbeat every 30s\n    const heartbeat = setInterval(() => {\n      sendPing();\n    }, 30000);\n    \n    return () => {\n      clearInterval(heartbeat);\n      disconnect();\n    };\n  }, [connect, disconnect, sendPing]);\n  \n  return {\n    status,\n    vehicles: Array.from(vehicles.values()),\n    vehicleMap: vehicles,\n    alerts,\n    lastChatResponse,\n    sendChatMessage,\n    connect,\n    disconnect,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/components/AlertFeed.tsx"],"sourcesContent":["\"use client\";\n\nimport type { AlertData } from \"../hooks/useWebSocket\";\n\ntype AlertFeedProps = {\n  alerts: AlertData[];\n  onAlertClick?: (alert: AlertData) => void;\n  maxItems?: number;\n};\n\nfunction formatTime(timestamp: number): string {\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString(\"en-IN\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: false,\n  });\n}\n\nfunction getSeverityIcon(severity: string): string {\n  switch (severity) {\n    case \"CRITICAL\":\n      return \"üî¥\";\n    case \"WARNING\":\n      return \"üü°\";\n    default:\n      return \"üü¢\";\n  }\n}\n\nfunction getSeverityClass(severity: string): string {\n  switch (severity) {\n    case \"CRITICAL\":\n      return \"badge--critical\";\n    case \"WARNING\":\n      return \"badge--warning\";\n    default:\n      return \"badge--info\";\n  }\n}\n\nexport function AlertFeed({ alerts, onAlertClick, maxItems = 20 }: AlertFeedProps) {\n  const displayAlerts = alerts.slice(0, maxItems);\n  \n  if (displayAlerts.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center h-full p-4\">\n        <div className=\"text-4xl mb-2\">‚úì</div>\n        <div className=\"mono text-center\" style={{ color: \"var(--text-muted)\", fontSize: \"12px\" }}>\n          No active alerts\n        </div>\n      </div>\n    );\n  }\n  \n  return (\n    <div className=\"flex flex-col overflow-y-auto\" style={{ maxHeight: \"100%\" }}>\n      {displayAlerts.map((alert, index) => (\n        <div\n          key={alert.alert_id || `${alert.vehicle_id}-${alert.timestamp}-${index}`}\n          className=\"p-3 cursor-pointer transition-colors\"\n          style={{\n            borderBottom: \"1px solid var(--border-color)\",\n            background: index === 0 ? \"var(--bg-surface)\" : \"transparent\",\n          }}\n          onClick={() => onAlertClick?.(alert)}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = \"var(--bg-hover)\";\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = index === 0 ? \"var(--bg-surface)\" : \"transparent\";\n          }}\n        >\n          {/* Header row */}\n          <div className=\"flex items-center justify-between mb-1\">\n            <div className=\"flex items-center gap-2\">\n              <span>{getSeverityIcon(alert.severity)}</span>\n              <span \n                className=\"mono font-bold\"\n                style={{ \n                  fontSize: \"13px\",\n                  color: alert.severity === \"CRITICAL\" ? \"var(--accent-red)\" : \n                         alert.severity === \"WARNING\" ? \"var(--accent-amber)\" : \"var(--text-primary)\"\n                }}\n              >\n                {alert.vehicle_id}\n              </span>\n            </div>\n            <span className={`badge ${getSeverityClass(alert.severity)}`}>\n              {alert.alert_type}\n            </span>\n          </div>\n          \n          {/* Message */}\n          <p \n            className=\"mono m-0 mb-1\"\n            style={{ \n              fontSize: \"11px\", \n              color: \"var(--text-secondary)\",\n              lineHeight: 1.4,\n            }}\n          >\n            {alert.message}\n          </p>\n          \n          {/* Footer - time and coordinates */}\n          <div \n            className=\"flex items-center justify-between mono\"\n            style={{ fontSize: \"10px\", color: \"var(--text-muted)\" }}\n          >\n            <span>{formatTime(alert.timestamp)}</span>\n            <span>\n              {alert.latitude.toFixed(4)}¬∞N, {alert.longitude.toFixed(4)}¬∞E\n            </span>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAUA,SAAS,WAAW,SAAiB;IACnC,MAAM,OAAO,IAAI,KAAK;IACtB,OAAO,KAAK,kBAAkB,CAAC,SAAS;QACtC,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,QAAQ;IACV;AACF;AAEA,SAAS,gBAAgB,QAAgB;IACvC,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEA,SAAS,iBAAiB,QAAgB;IACxC,OAAQ;QACN,KAAK;YACH,OAAO;QACT,KAAK;YACH,OAAO;QACT;YACE,OAAO;IACX;AACF;AAEO,SAAS,UAAU,EAAE,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,EAAkB;IAC/E,MAAM,gBAAgB,OAAO,KAAK,CAAC,GAAG;IAEtC,IAAI,cAAc,MAAM,KAAK,GAAG;QAC9B,qBACE,+YAAC;YAAI,WAAU;;8BACb,+YAAC;oBAAI,WAAU;8BAAgB;;;;;;8BAC/B,+YAAC;oBAAI,WAAU;oBAAmB,OAAO;wBAAE,OAAO;wBAAqB,UAAU;oBAAO;8BAAG;;;;;;;;;;;;IAKjG;IAEA,qBACE,+YAAC;QAAI,WAAU;QAAgC,OAAO;YAAE,WAAW;QAAO;kBACvE,cAAc,GAAG,CAAC,CAAC,OAAO,sBACzB,+YAAC;gBAEC,WAAU;gBACV,OAAO;oBACL,cAAc;oBACd,YAAY,UAAU,IAAI,sBAAsB;gBAClD;gBACA,SAAS,IAAM,eAAe;gBAC9B,cAAc,CAAC;oBACb,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG;gBACrC;gBACA,cAAc,CAAC;oBACb,EAAE,aAAa,CAAC,KAAK,CAAC,UAAU,GAAG,UAAU,IAAI,sBAAsB;gBACzE;;kCAGA,+YAAC;wBAAI,WAAU;;0CACb,+YAAC;gCAAI,WAAU;;kDACb,+YAAC;kDAAM,gBAAgB,MAAM,QAAQ;;;;;;kDACrC,+YAAC;wCACC,WAAU;wCACV,OAAO;4CACL,UAAU;4CACV,OAAO,MAAM,QAAQ,KAAK,aAAa,sBAChC,MAAM,QAAQ,KAAK,YAAY,wBAAwB;wCAChE;kDAEC,MAAM,UAAU;;;;;;;;;;;;0CAGrB,+YAAC;gCAAK,WAAW,CAAC,MAAM,EAAE,iBAAiB,MAAM,QAAQ,GAAG;0CACzD,MAAM,UAAU;;;;;;;;;;;;kCAKrB,+YAAC;wBACC,WAAU;wBACV,OAAO;4BACL,UAAU;4BACV,OAAO;4BACP,YAAY;wBACd;kCAEC,MAAM,OAAO;;;;;;kCAIhB,+YAAC;wBACC,WAAU;wBACV,OAAO;4BAAE,UAAU;4BAAQ,OAAO;wBAAoB;;0CAEtD,+YAAC;0CAAM,WAAW,MAAM,SAAS;;;;;;0CACjC,+YAAC;;oCACE,MAAM,QAAQ,CAAC,OAAO,CAAC;oCAAG;oCAAK,MAAM,SAAS,CAAC,OAAO,CAAC;oCAAG;;;;;;;;;;;;;;eArD1D,MAAM,QAAQ,IAAI,GAAG,MAAM,UAAU,CAAC,CAAC,EAAE,MAAM,SAAS,CAAC,CAAC,EAAE,OAAO;;;;;;;;;;AA4DlF"}},
    {"offset": {"line": 355, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/components/EmissionGauges.tsx"],"sourcesContent":["\"use client\";\n\nimport type { EmissionData } from \"../hooks/useWebSocket\";\n\ntype EmissionGaugesProps = {\n  vehicles: EmissionData[];\n  selectedVehicle?: string | null;\n  onVehicleSelect?: (vehicleId: string) => void;\n};\n\n// Daily carbon quota per vehicle (kg)\nconst DAILY_QUOTA_KG = 80;\n\nfunction getStatusColor(vehicle: EmissionData): string {\n  if (vehicle.alert_severity === \"CRITICAL\") return \"var(--accent-red)\";\n  if (vehicle.alert_severity === \"WARNING\") return \"var(--accent-amber)\";\n  return \"var(--accent-green)\";\n}\n\nfunction getQuotaPercentage(cumulativeCo2Kg: number): number {\n  return Math.min(100, (cumulativeCo2Kg / DAILY_QUOTA_KG) * 100);\n}\n\nfunction getQuotaColor(percentage: number): string {\n  if (percentage >= 90) return \"var(--accent-red)\";\n  if (percentage >= 70) return \"var(--accent-amber)\";\n  return \"var(--accent-green)\";\n}\n\nexport function EmissionGauges({ vehicles, selectedVehicle, onVehicleSelect }: EmissionGaugesProps) {\n  // Calculate fleet-wide stats\n  const totalCo2Kg = vehicles.reduce((sum, v) => sum + v.cumulative_co2_kg, 0);\n  const fleetQuota = DAILY_QUOTA_KG * vehicles.length;\n  const fleetPercentage = fleetQuota > 0 ? (totalCo2Kg / fleetQuota) * 100 : 0;\n  \n  const criticalCount = vehicles.filter(v => v.alert_severity === \"CRITICAL\").length;\n  const warningCount = vehicles.filter(v => v.alert_severity === \"WARNING\").length;\n  \n  return (\n    <div className=\"flex flex-col gap-4 p-4 h-full overflow-y-auto\">\n      {/* Fleet-wide gauge */}\n      <div className=\"card-surface\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h4 className=\"text-sm font-bold\" style={{ color: \"var(--text-primary)\" }}>\n            FLEET CARBON QUOTA\n          </h4>\n          <span className=\"mono\" style={{ fontSize: \"12px\", color: \"var(--text-muted)\" }}>\n            {vehicles.length} vehicles\n          </span>\n        </div>\n        \n        {/* Progress bar */}\n        <div \n          className=\"w-full h-6 mb-2\"\n          style={{ background: \"var(--bg-primary)\", border: \"1px solid var(--border-color)\" }}\n        >\n          <div\n            className=\"h-full transition-all\"\n            style={{\n              width: `${Math.min(100, fleetPercentage)}%`,\n              background: getQuotaColor(fleetPercentage),\n            }}\n          />\n        </div>\n        \n        <div className=\"flex justify-between mono\" style={{ fontSize: \"12px\" }}>\n          <span style={{ color: getQuotaColor(fleetPercentage) }}>\n            {totalCo2Kg.toFixed(1)} kg\n          </span>\n          <span style={{ color: \"var(--text-muted)\" }}>\n            /{fleetQuota} kg ({fleetPercentage.toFixed(0)}%)\n          </span>\n        </div>\n        \n        {/* Alert summary */}\n        {(criticalCount > 0 || warningCount > 0) && (\n          <div className=\"flex gap-4 mt-3 pt-3\" style={{ borderTop: \"1px solid var(--border-color)\" }}>\n            {criticalCount > 0 && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"status-dot status-dot--red\"></span>\n                <span className=\"mono\" style={{ fontSize: \"12px\", color: \"var(--accent-red)\" }}>\n                  {criticalCount} Critical\n                </span>\n              </div>\n            )}\n            {warningCount > 0 && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"status-dot status-dot--amber\"></span>\n                <span className=\"mono\" style={{ fontSize: \"12px\", color: \"var(--accent-amber)\" }}>\n                  {warningCount} Warning\n                </span>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n      \n      {/* Per-vehicle stats */}\n      <div className=\"flex flex-col gap-2\">\n        <h4 \n          className=\"text-xs font-bold uppercase\"\n          style={{ color: \"var(--text-muted)\", letterSpacing: \"0.1em\" }}\n        >\n          Vehicle Status\n        </h4>\n        \n        {vehicles.map((vehicle) => {\n          const quotaPercent = getQuotaPercentage(vehicle.cumulative_co2_kg);\n          const isSelected = vehicle.vehicle_id === selectedVehicle;\n          const statusColor = getStatusColor(vehicle);\n          \n          return (\n            <div\n              key={vehicle.vehicle_id}\n              className=\"p-2 cursor-pointer transition-all\"\n              style={{\n                background: isSelected ? \"var(--bg-surface)\" : \"transparent\",\n                border: isSelected ? \"2px solid var(--accent-blue)\" : \"1px solid var(--border-color)\",\n              }}\n              onClick={() => onVehicleSelect?.(vehicle.vehicle_id)}\n              onMouseEnter={(e) => {\n                if (!isSelected) e.currentTarget.style.background = \"var(--bg-hover)\";\n              }}\n              onMouseLeave={(e) => {\n                if (!isSelected) e.currentTarget.style.background = \"transparent\";\n              }}\n            >\n              <div className=\"flex items-center justify-between mb-1\">\n                <div className=\"flex items-center gap-2\">\n                  <span \n                    className=\"status-dot\"\n                    style={{\n                      background: statusColor,\n                      boxShadow: vehicle.alert_severity !== \"INFO\" \n                        ? `0 0 8px ${statusColor}` \n                        : \"none\",\n                    }}\n                  ></span>\n                  <span className=\"mono font-bold\" style={{ fontSize: \"13px\" }}>\n                    {vehicle.vehicle_id}\n                  </span>\n                </div>\n                <span \n                  className=\"mono font-bold\"\n                  style={{ fontSize: \"13px\", color: statusColor }}\n                >\n                  {vehicle.co2_rate_g_per_km > 0 \n                    ? `${vehicle.co2_rate_g_per_km.toFixed(0)} g/km`\n                    : \"IDLE\"\n                  }\n                </span>\n              </div>\n              \n              {/* Mini progress bar */}\n              <div \n                className=\"w-full h-1\"\n                style={{ background: \"var(--bg-primary)\" }}\n              >\n                <div\n                  className=\"h-full\"\n                  style={{\n                    width: `${quotaPercent}%`,\n                    background: getQuotaColor(quotaPercent),\n                  }}\n                />\n              </div>\n              \n              <div className=\"flex justify-between mt-1 mono\" style={{ fontSize: \"10px\", color: \"var(--text-muted)\" }}>\n                <span>{vehicle.speed_kmh.toFixed(0)} km/h</span>\n                <span>{vehicle.cumulative_co2_kg.toFixed(2)} kg</span>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/components/ChatSidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect } from \"react\";\nimport type { ChatResponse } from \"../hooks/useWebSocket\";\n\ntype ChatSidebarProps = {\n  onSendMessage: (query: string) => void;\n  lastResponse: ChatResponse | null;\n  isConnected: boolean;\n};\n\ntype Message = {\n  id: string;\n  type: \"user\" | \"assistant\";\n  content: string;\n  citations?: string[];\n  timestamp: number;\n};\n\nexport function ChatSidebar({ onSendMessage, lastResponse, isConnected }: ChatSidebarProps) {\n  const [input, setInput] = useState(\"\");\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  \n  // Scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n  \n  // Handle incoming response\n  useEffect(() => {\n    if (lastResponse) {\n      setMessages((prev) => [\n        ...prev,\n        {\n          id: lastResponse.message_id,\n          type: \"assistant\",\n          content: lastResponse.response,\n          citations: lastResponse.citations,\n          timestamp: lastResponse.timestamp,\n        },\n      ]);\n      setIsLoading(false);\n    }\n  }, [lastResponse]);\n  \n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!input.trim() || !isConnected || isLoading) return;\n    \n    const query = input.trim();\n    \n    // Add user message\n    setMessages((prev) => [\n      ...prev,\n      {\n        id: `user_${Date.now()}`,\n        type: \"user\",\n        content: query,\n        timestamp: Date.now(),\n      },\n    ]);\n    \n    // Send to backend\n    onSendMessage(query);\n    setInput(\"\");\n    setIsLoading(true);\n  };\n  \n  const suggestedQueries = [\n    \"Why is TRK-102 flagged?\",\n    \"Which trucks exceeded quota?\",\n    \"What are BS-VI idle limits?\",\n  ];\n  \n  return (\n    <div className=\"flex flex-col h-full\" style={{ background: \"var(--bg-elevated)\" }}>\n      {/* Header */}\n      <div \n        className=\"p-3 flex items-center justify-between\"\n        style={{ borderBottom: \"var(--border-brutal)\" }}\n      >\n        <h3 className=\"text-sm font-bold\" style={{ color: \"var(--text-primary)\" }}>\n          üí¨ ASK PATHGREEN\n        </h3>\n        <div \n          className=\"mono\"\n          style={{ \n            fontSize: \"10px\", \n            color: isConnected ? \"var(--accent-green)\" : \"var(--text-muted)\" \n          }}\n        >\n          {isConnected ? \"‚óè ONLINE\" : \"‚óã OFFLINE\"}\n        </div>\n      </div>\n      \n      {/* Messages area */}\n      <div \n        className=\"flex-1 overflow-y-auto p-3\"\n        style={{ background: \"var(--bg-primary)\" }}\n      >\n        {messages.length === 0 ? (\n          <div className=\"flex flex-col gap-4\">\n            <p \n              className=\"mono text-center\"\n              style={{ fontSize: \"12px\", color: \"var(--text-muted)\" }}\n            >\n              Ask about fleet emissions, alerts, or BS-VI regulations.\n            </p>\n            \n            {/* Suggested queries */}\n            <div className=\"flex flex-col gap-2\">\n              {suggestedQueries.map((query) => (\n                <button\n                  key={query}\n                  className=\"p-2 text-left transition-colors mono\"\n                  style={{\n                    fontSize: \"11px\",\n                    background: \"var(--bg-surface)\",\n                    border: \"1px solid var(--border-color)\",\n                    color: \"var(--text-secondary)\",\n                    cursor: \"pointer\",\n                  }}\n                  onClick={() => {\n                    setInput(query);\n                  }}\n                  onMouseEnter={(e) => {\n                    e.currentTarget.style.borderColor = \"var(--accent-blue)\";\n                    e.currentTarget.style.color = \"var(--text-primary)\";\n                  }}\n                  onMouseLeave={(e) => {\n                    e.currentTarget.style.borderColor = \"var(--border-color)\";\n                    e.currentTarget.style.color = \"var(--text-secondary)\";\n                  }}\n                >\n                  {query}\n                </button>\n              ))}\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex flex-col gap-3\">\n            {messages.map((msg) => (\n              <div\n                key={msg.id}\n                className={`p-3 ${msg.type === \"user\" ? \"ml-4\" : \"mr-4\"}`}\n                style={{\n                  background: msg.type === \"user\" ? \"var(--bg-surface)\" : \"var(--bg-elevated)\",\n                  border: msg.type === \"user\" \n                    ? \"1px solid var(--accent-blue)\" \n                    : \"var(--border-brutal)\",\n                }}\n              >\n                {/* Message header */}\n                <div \n                  className=\"flex items-center justify-between mb-2\"\n                  style={{ fontSize: \"10px\", color: \"var(--text-muted)\" }}\n                >\n                  <span className=\"mono uppercase font-bold\">\n                    {msg.type === \"user\" ? \"You\" : \"PathGreen AI\"}\n                  </span>\n                </div>\n                \n                {/* Message content */}\n                <div \n                  className=\"mono prose prose-invert prose-sm max-w-none\"\n                  style={{ \n                    fontSize: \"12px\", \n                    color: \"var(--text-primary)\",\n                    lineHeight: 1.6,\n                    whiteSpace: \"pre-wrap\",\n                  }}\n                  dangerouslySetInnerHTML={{ \n                    __html: formatMarkdown(msg.content) \n                  }}\n                />\n                \n                {/* Citations */}\n                {msg.citations && msg.citations.length > 0 && (\n                  <div \n                    className=\"mt-2 pt-2\"\n                    style={{ borderTop: \"1px solid var(--border-color)\" }}\n                  >\n                    <span \n                      className=\"mono\"\n                      style={{ fontSize: \"10px\", color: \"var(--text-muted)\" }}\n                    >\n                      Sources: {msg.citations.join(\", \")}\n                    </span>\n                  </div>\n                )}\n              </div>\n            ))}\n            \n            {/* Loading indicator */}\n            {isLoading && (\n              <div \n                className=\"p-3 mr-4\"\n                style={{ \n                  background: \"var(--bg-elevated)\", \n                  border: \"var(--border-brutal)\" \n                }}\n              >\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex gap-1\">\n                    <span \n                      className=\"w-2 h-2 rounded-full animate-pulse\"\n                      style={{ background: \"var(--accent-green)\", animationDelay: \"0ms\" }}\n                    />\n                    <span \n                      className=\"w-2 h-2 rounded-full animate-pulse\"\n                      style={{ background: \"var(--accent-green)\", animationDelay: \"150ms\" }}\n                    />\n                    <span \n                      className=\"w-2 h-2 rounded-full animate-pulse\"\n                      style={{ background: \"var(--accent-green)\", animationDelay: \"300ms\" }}\n                    />\n                  </div>\n                  <span className=\"mono\" style={{ fontSize: \"11px\", color: \"var(--text-muted)\" }}>\n                    Analyzing...\n                  </span>\n                </div>\n              </div>\n            )}\n            \n            <div ref={messagesEndRef} />\n          </div>\n        )}\n      </div>\n      \n      {/* Input area */}\n      <form \n        onSubmit={handleSubmit}\n        className=\"p-3\"\n        style={{ borderTop: \"var(--border-brutal)\" }}\n      >\n        <div className=\"flex gap-2\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder={isConnected ? \"Ask about fleet emissions...\" : \"Connecting...\"}\n            disabled={!isConnected || isLoading}\n            className=\"input flex-1\"\n            style={{ fontSize: \"12px\" }}\n          />\n          <button\n            type=\"submit\"\n            disabled={!isConnected || isLoading || !input.trim()}\n            className=\"btn btn--primary\"\n            style={{ \n              padding: \"8px 16px\",\n              opacity: (!isConnected || isLoading || !input.trim()) ? 0.5 : 1,\n            }}\n          >\n            ‚Üí\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n\n// Simple markdown to HTML conversion\nfunction formatMarkdown(text: string): string {\n  return text\n    // Bold\n    .replace(/\\*\\*(.*?)\\*\\*/g, \"<strong>$1</strong>\")\n    // Headers\n    .replace(/^### (.*$)/gm, \"<h4 style='margin: 8px 0 4px; font-size: 12px;'>$1</h4>\")\n    .replace(/^## (.*$)/gm, \"<h3 style='margin: 8px 0 4px; font-size: 13px;'>$1</h3>\")\n    // Lists\n    .replace(/^- (.*$)/gm, \"<li style='margin-left: 16px;'>$1</li>\")\n    .replace(/^‚Ä¢ (.*$)/gm, \"<li style='margin-left: 16px;'>$1</li>\")\n    // Table rows (simple)\n    .replace(/\\|(.*)\\|/g, (match) => {\n      const cells = match.split(\"|\").filter(Boolean);\n      return `<div style=\"display: flex; gap: 8px; font-size: 11px; padding: 2px 0; border-bottom: 1px solid var(--border-color);\">${cells.map(c => `<span style=\"flex: 1;\">${c.trim()}</span>`).join(\"\")}</div>`;\n    })\n    // Line breaks\n    .replace(/\\n/g, \"<br />\");\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1134, "column": 0}, "map": {"version":3,"sources":["file:///home/aegis-dev/dev-code/pathgreen-ai/frontend/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport dynamic from \"next/dynamic\";\nimport { useWebSocket } from \"./hooks/useWebSocket\";\nimport { AlertFeed } from \"./components/AlertFeed\";\nimport { EmissionGauges } from \"./components/EmissionGauges\";\nimport { ChatSidebar } from \"./components/ChatSidebar\";\n\n// Dynamic import for map (requires window)\nconst FleetMap = dynamic(\n  () => import(\"./components/FleetMap\").then((mod) => mod.FleetMap),\n  { \n    ssr: false,\n    loading: () => (\n      <div \n        className=\"w-full h-full flex items-center justify-center\"\n        style={{ background: \"var(--bg-void)\" }}\n      >\n        <div className=\"mono\" style={{ color: \"var(--text-muted)\" }}>\n          Loading map...\n        </div>\n      </div>\n    ),\n  }\n);\n\nexport default function Dashboard() {\n  const { \n    status, \n    vehicles, \n    alerts, \n    lastChatResponse, \n    sendChatMessage \n  } = useWebSocket();\n  \n  const [selectedVehicle, setSelectedVehicle] = useState<string | null>(null);\n  const [activePanel, setActivePanel] = useState<\"gauges\" | \"alerts\">(\"gauges\");\n  \n  const isConnected = status === \"connected\";\n  \n  return (\n    <div className=\"dashboard-grid\">\n      {/* ================================================================\n          HEADER\n          ================================================================ */}\n      <header \n        className=\"header col-span-2\"\n        style={{ gridColumn: \"1 / -1\" }}\n      >\n        <div className=\"flex items-center gap-4\">\n          {/* Logo */}\n          <h1 \n            className=\"text-xl font-bold tracking-tight\"\n            style={{ color: \"var(--accent-green)\" }}\n          >\n            PATHGREEN<span style={{ color: \"var(--text-primary)\" }}>-AI</span>\n          </h1>\n          \n          {/* Stats */}\n          <div className=\"flex items-center gap-4 ml-8\">\n            <div className=\"mono\" style={{ fontSize: \"12px\", color: \"var(--text-secondary)\" }}>\n              <span style={{ color: \"var(--text-primary)\", fontWeight: 600 }}>\n                {vehicles.length}\n              </span>\n              {\" \"}Vehicles\n            </div>\n            <div className=\"mono\" style={{ fontSize: \"12px\", color: \"var(--text-secondary)\" }}>\n              <span style={{ color: alerts.filter(a => a.severity === \"CRITICAL\").length > 0 ? \"var(--accent-red)\" : \"var(--text-primary)\", fontWeight: 600 }}>\n                {alerts.filter(a => a.severity === \"CRITICAL\" || a.severity === \"WARNING\").length}\n              </span>\n              {\" \"}Alerts\n            </div>\n          </div>\n        </div>\n        \n        {/* Connection status */}\n        <div className=\"live-indicator\">\n          {isConnected ? (\n            <>\n              <span className=\"live-indicator__dot\"></span>\n              <span style={{ color: \"var(--accent-green)\" }}>LIVE</span>\n            </>\n          ) : (\n            <>\n              <span \n                className=\"w-2 h-2 rounded-full\"\n                style={{ background: \"var(--accent-amber)\" }}\n              ></span>\n              <span style={{ color: \"var(--accent-amber)\" }}>\n                {status === \"connecting\" ? \"CONNECTING...\" : \"DISCONNECTED\"}\n              </span>\n            </>\n          )}\n        </div>\n      </header>\n      \n      {/* ================================================================\n          MAIN CONTENT - Map\n          ================================================================ */}\n      <main \n        className=\"relative\"\n        style={{ \n          gridColumn: \"1\", \n          gridRow: \"2 / 4\",\n          minHeight: 0,\n        }}\n      >\n        <FleetMap\n          vehicles={vehicles}\n          selectedVehicle={selectedVehicle}\n          onVehicleSelect={setSelectedVehicle}\n        />\n        \n        {/* Map overlay - selected vehicle info */}\n        {selectedVehicle && (\n          <div \n            className=\"absolute top-4 left-4 p-4 card z-[1000]\"\n            style={{ minWidth: \"200px\" }}\n          >\n            <div className=\"flex items-center justify-between mb-2\">\n              <h3 className=\"text-sm font-bold\">{selectedVehicle}</h3>\n              <button\n                className=\"mono text-xs\"\n                style={{ color: \"var(--text-muted)\", cursor: \"pointer\" }}\n                onClick={() => setSelectedVehicle(null)}\n              >\n                ‚úï\n              </button>\n            </div>\n            {(() => {\n              const vehicle = vehicles.find(v => v.vehicle_id === selectedVehicle);\n              if (!vehicle) return null;\n              return (\n                <div className=\"mono\" style={{ fontSize: \"11px\" }}>\n                  <div className=\"flex justify-between mb-1\">\n                    <span style={{ color: \"var(--text-muted)\" }}>Position</span>\n                    <span>{vehicle.latitude.toFixed(4)}¬∞N, {vehicle.longitude.toFixed(4)}¬∞E</span>\n                  </div>\n                  <div className=\"flex justify-between mb-1\">\n                    <span style={{ color: \"var(--text-muted)\" }}>Speed</span>\n                    <span>{vehicle.speed_kmh.toFixed(1)} km/h</span>\n                  </div>\n                  <div className=\"flex justify-between\">\n                    <span style={{ color: \"var(--text-muted)\" }}>CO‚ÇÇ Rate</span>\n                    <span style={{ \n                      color: vehicle.alert_severity === \"CRITICAL\" ? \"var(--accent-red)\" :\n                             vehicle.alert_severity === \"WARNING\" ? \"var(--accent-amber)\" : \n                             \"var(--accent-green)\"\n                    }}>\n                      {vehicle.co2_rate_g_per_km.toFixed(0)} g/km\n                    </span>\n                  </div>\n                </div>\n              );\n            })()}\n          </div>\n        )}\n      </main>\n      \n      {/* ================================================================\n          SIDEBAR - Gauges/Alerts + Chat\n          ================================================================ */}\n      <aside className=\"sidebar\" style={{ gridColumn: \"2\", gridRow: \"2 / 4\" }}>\n        {/* Panel toggle */}\n        <div \n          className=\"flex\"\n          style={{ borderBottom: \"var(--border-brutal)\" }}\n        >\n          <button\n            className={`flex-1 py-2 px-4 mono text-xs uppercase font-bold transition-colors`}\n            style={{\n              background: activePanel === \"gauges\" ? \"var(--bg-surface)\" : \"transparent\",\n              color: activePanel === \"gauges\" ? \"var(--text-primary)\" : \"var(--text-muted)\",\n              borderRight: \"1px solid var(--border-color)\",\n            }}\n            onClick={() => setActivePanel(\"gauges\")}\n          >\n            Emissions\n          </button>\n          <button\n            className={`flex-1 py-2 px-4 mono text-xs uppercase font-bold transition-colors relative`}\n            style={{\n              background: activePanel === \"alerts\" ? \"var(--bg-surface)\" : \"transparent\",\n              color: activePanel === \"alerts\" ? \"var(--text-primary)\" : \"var(--text-muted)\",\n            }}\n            onClick={() => setActivePanel(\"alerts\")}\n          >\n            Alerts\n            {alerts.filter(a => a.severity === \"CRITICAL\").length > 0 && (\n              <span \n                className=\"absolute top-1 right-2 w-2 h-2 rounded-full\"\n                style={{ background: \"var(--accent-red)\" }}\n              />\n            )}\n          </button>\n        </div>\n        \n        {/* Panel content */}\n        <div className=\"flex-1 overflow-hidden\">\n          {activePanel === \"gauges\" ? (\n            <EmissionGauges\n              vehicles={vehicles}\n              selectedVehicle={selectedVehicle}\n              onVehicleSelect={setSelectedVehicle}\n            />\n          ) : (\n            <AlertFeed\n              alerts={alerts}\n              onAlertClick={(alert) => setSelectedVehicle(alert.vehicle_id)}\n            />\n          )}\n        </div>\n        \n        {/* Chat - always visible at bottom */}\n        <div \n          style={{ \n            height: \"280px\", \n            borderTop: \"var(--border-brutal)\",\n            flexShrink: 0,\n          }}\n        >\n          <ChatSidebar\n            onSendMessage={sendChatMessage}\n            lastResponse={lastChatResponse}\n            isConnected={isConnected}\n          />\n        </div>\n      </aside>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}